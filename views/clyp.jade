extends layout
block append head
  style(type="text/css").
    html, body,  #map-canvas { height:500px; margin: 0; padding: 0;}
  script(type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=#{API_KEY}")
  script.
    function initialize() {
      var myLatLng = new google.maps.LatLng(#{latitude}, #{longitude});
      var mapOptions = { 
        center: myLatLng, 
        zoom: 10 };
      var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

      var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        title: "This is where the sound comes from"
      });
    var mapDiv = document.getElementById('map-updater');
    google.maps.event.addListener(mapDiv, 'click', refresh);
    }
    function refresh() {
      setTimeout(function() {
        var myLatLng = new google.maps.LatLng(#{latitude}, #{longitude});
        var myOptions = {
          zoom: 10,
          center: myLatLng,
        };

        var map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
        var marker = new google.maps.Marker({
          position: myLatLng,
          map: map,
          title: "herpy deeerpy"
        });
      }, 4000);
      }

    google.maps.event.addDomListener(window, 'load', initialize);

block content
  include navbar
  h1 Hello, World!
  .container
    .row
      .col-md-6
        .starter-template(style="padding-top:70px;")
          form(role='form',action='/clyp',method='post', id='usrform')
            div.form-group: label(for='audioURL') Enter Clyp.it URL:  
                input.form-control(id='audioURL',type='audioURL',name='audioURL',placeholder="")
            input#map-updater(type='submit',value='Submit')
      .col-md-6
        for item in clypResults
          p #{item}
  .container
    .row
      .col-md-12
        #map-canvas
